function plot_color_gram_cepstrum(gram,data,pdata,Fs,n_step,titletext)% Filename:         plot_color_gram_cepstrum.m% Author:           D.R.Ohm   % Software:         Matlab R2020b% Rev.Date:         July 22,2005; Mar.1,2021% gram --  a 2-D array of values from TFA_Analysis_complex script, %          arranged by columns of frequency bins vs rows of the center %          analysis time values; each row contains all the frequency bins %          corresponding to a center times. Thus a row index corresponds%          to particular center time and a column index corresponds to a%          particular frequency bin in Hz.% data --  The original data array (data must be complex-valued)% pdata -- periodicity data% Fs --    The sampling rate in samples per second (Hz)% n_step --  Number of samples between analysis data blocks%              TFA_Analysis_complex script%% titletext -- Title of gram plot entered between quotes ('STFT ...')%% Needed Filed:%   perogram.m%%==========================================================================ep = 1.0e-16;Ts=1/Fs;    % sampling interval in sec [n_rows,n_cols]=size(gram);max_gram = max(max(gram));log_gram = 10*log10(gram/max_gram + ep);dB_top = input('Enter top range in dB (suggest: 0): ');dB_bottom = input('Enter bottom range in dB (sugggest: 60): ');vec = find(log_gram < (-dB_bottom));log_gram(vec) = -dB_bottom*ones(size(vec));vec = find(log_gram > (-dB_top));log_gram(vec) = -dB_top*ones(size(vec));selection = input('Enter 0 for gray scale, 1 for color scale: ');%-Plot Titlefigure('PaperOrientation','portrait',...              'PaperPosition',[1.1,1,6.5,9],...              'Position',[500,500,820,620],...              'Units','pixel');p_axis = 0:Ts:n_cols*Ts-Ts;pmax = p_axis(end);                     % max period in Quefrenceytc_axis = (0:n_rows-1)*(n_step)*Ts;tcmax = Ts*(n_rows-1)*(n_step);          % max center time in sec axwidth = .78;axes('Position',[.2,.97,axwidth,1],...                'Units','normalized',...                'Visible','off');%-Figure titletext('Position',[.5,0],...                  'Units','normalized',...                  'FontSize',[14],...                  'HorizontalAlignment','center',...                  'VerticalAlignment','bottom',...                  'String','CENTER TIME - VS - PERIOD');% Time-vs-frequency gram plotaxbottom = .19;axheight = .73;axes('Position',[.20,axbottom,axwidth,axheight],...           'Units','normalized',...           'FontSize',[10],...           'Box','on',...           'TickDir','out',...           'NextPlot','add',...           'XGrid','off',...           'XLim',[0,pmax],...           'YLim',[0,tcmax]);           if selection == 0    colormap(gray(256));else    map = hsv(329);    colormap(map(256:-1:1,:));endtitle(titletext)ylabel('Center Time of Analysis Window (sec)')imagesc(p_axis,tc_axis,log_gram)%-Signal-vs-time plot to left of time-vs-frequency gram plotdata_max = max(abs(data));axes('Position',[.02,axbottom,.075,axheight],...           'Units','normalized',...           'Box','on',...           'NextPlot','add',...           'FontSize',[9],...           'XLim',[-data_max,data_max],...           'XDir','reverse',...           'YTickLabelMode','manual',...           'YTickLabel',[],...           'YLim',[0,tcmax]);    t_axis = (1:length(data))*Ts;plot(real(data),t_axis,'k')xlabel('Input')%-Periodicity plot on bottomaxes('Position',[.20,.04,axwidth,.09],...           'Units','normalized',...           'Box','on',...           'NextPlot','add',...           'FontSize',[10],...           'TickDir','in',...           'XTickLabelMode','manual',...           'XTickLabel',[],...           'XLim',[0,pmax],...           'YLim',[-0.05,0.1]);    plot(p_axis,pdata,'k');gridxlabel('Quefrency = Averaged Periodicity (sec)')ylabel('Mag')%Color bar legend on left bottomaxes('Position',[.02,.07,.10,.03],...           'Units','normalized',...           'Box','on',...           'NextPlot','add',...           'FontSize',[9],...           'YLim',[1,2],...           'TickDir','out',...           'YTickLabelMode','manual',...           'YTickLabel',[],...           'XLim',[-dB_bottom,-dB_top]);vec = (-dB_bottom:-dB_top)';barr = [vec vec]';imagesc((-dB_bottom:-dB_top),(1:2),barr)xlabel('dB colormap')